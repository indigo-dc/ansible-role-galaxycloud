#!/bin/bash

################################################
#
# Galaxy startup script
#
################################################

#______________________________________
# Load Galaxy environment

echo "Loading Galaxy environment"
cd {{galaxy_install_path}}
. {{galaxy_venv_path}}/bin/activate

#______________________________________
# Define start function
# (supervisord or systemd/upstart)

function start_galaxy {
  echo "Starting the Galaxy production environment"
{% if ansible_virtualization_role == "docker" or (ansible_virtualization_role != "docker" and init_type == "supervisord") %}
  supervisord -c {{ supervisord_conf_path }}/supervisord.conf
{% else %}
{% if ansible_os_family == "Debian" and ansible_distribution_version == "14.04" %}
  service galaxy start
{% else %}
  systemctl start galaxy.service
{% endif %}
{% endif %}

}

#______________________________________
# Start Galaxy production environment
start_galaxy
